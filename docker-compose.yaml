version: "3.8"

services:
  server:
    restart: unless-stopped
    build:
      context: ./server
      dockerfile: Dockerfile
      args:
        - HOSTING_PATH
    volumes:
      - ./server/conf/nginx.conf:/etc/nginx/nginx.conf
      - ./server/conf/leprechaun.conf:/etc/nginx/conf.d/leprechaun.conf
      - ./server/conf/leprechaun.dev.conf:/etc/nginx/conf.d/leprechaun.dev.conf
    depends_on:
      - admin
      - client

  db:
    restart: unless-stopped
    volumes:
      - ./db/postgresql.conf:/app/postgresql.conf

  session:
    restart: unless-stopped
    volumes:
      - ./session/redis.conf:/app/redis.conf

  cache:
    restart: unless-stopped
    volumes:
      - ./cache/redis.conf:/app/redis.conf

  api:
    restart: unless-stopped
    build: ./api
    volumes:
      - ./api:/app
    environment:
      - IS_DEV=true

  manticore:
    restart: unless-stopped
    ports:
      - ${MANTICORE_PORT}:${MANTICORE_PORT}

  client:
    restart: unless-stopped
    build: ./client
    volumes:
      - ./client:/app
    environment:
      - IS_DEV=true

  admin:
    container_name: leprechaun_admin
    restart: unless-stopped
    build: ./admin
    volumes:
      - ./admin:/app
    environment:
      - LANGS
      - APP_NAME
      - DOMAIN_API
      - DOMAIN_MEDIA
    depends_on:
      - api
