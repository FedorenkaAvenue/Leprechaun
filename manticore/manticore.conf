source db {
	type	 = pgsql

	sql_host = leprechaun_postgres
	sql_user = postgres
	sql_pass = 2700
	sql_db	 = postgres
	sql_port = 5432

	sql_query_pre = SET NAMES 'utf8'
}

source products : db {
    sql_query = \
		SELECT \
			p.id AS p_id, \
			p.created_at, \
			p.title, \
			p.price, \
			p.rating, \
			p.is_public, \
			p.is_available, \
			p.description, \
			images, \
			category, \
			lb.id AS l_id, \
			lb.type AS l_type, \
			lb.value AS l_value, \
			pr AS properties \
		FROM product AS p \
		LEFT JOIN image AS images ON p.id = images.product_id \
		LEFT JOIN category ON category.id = p.category \
		LEFT JOIN _products_to_labels AS _lbls ON _lbls.product_id = p.id \
		LEFT JOIN label AS lb ON lb.id = _lbls.label_id \
		LEFT JOIN _products_to_properties AS _props ON _props.product_id = p.id \
		LEFT JOIN property AS pr ON pr.id = _props.property_id

	sql_attr_uint 	   = p_id
	sql_attr_string    = created_at
	sql_field_string   = title
	sql_attr_float     = price
	sql_attr_float     = rating
	sql_attr_bool      = is_public
	sql_attr_bool      = is_available
	sql_field_string   = description

	sql_field_string   = images

	sql_attr_float     = category

	sql_attr_float     = l_id
	sql_field_string   = l_type
	sql_field_string   = l_value

	sql_field_string   = properties
}

index products {
	type   = plain
    source = products
    path   = /var/lib/manticore/products
	
	index_exact_words = 1
    expand_keywords	  = 1
    min_word_len	  = 2
    min_infix_len     = 2

	morphology        = stem_enru
}

indexer {
	mem_limit  = 1024M
	max_iops   = 0
	max_iosize = 0
}

searchd {
	listen = 9306:mysql41
    listen = /var/run/mysqld/mysqld.sock:mysql41
    listen = 9308:http

	seamless_rotate  = 1
	preopen_indexes  = 1
	unlink_old       = 1

	pid_file    = /var/run/manticore/searchd.pid
	log         = /var/log/manticore/searchd.log
	query_log   = /var/log/manticore/query.log
	binlog_path = /var/lib/manticore
}
